<p><link rel="stylesheet" href="style.css"></p>

<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML'></script>


<script type="text/x-mathjax-config">
  MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}});
</script>


<p><a href="README.md">Changes</a>
<a href="BUGS.md">Bugs</a>
<a href="HELP.md">Help</a></p>

<p><img src="logo_758.jpg" alt="DOTTER LOGO" /></p>

<h1>Help</h1>

<ul>
<li><a href="#GettingStarted">Getting started</a></li>
<li><a href="#Installation">Installation</a>

<ul>
<li><a href="#Dependencies">Dependencies</a></li>
<li><a href="#Instructions">Instructions</a></li>
<li><a href="#KeepingUpdated">Keeping Updated</a></li>
</ul>
</li>
<li><a href="#Workflow">Workflow</a></li>
<li><a href="#SpecificTopics">Specific Topics</a>

<ul>
<li><a href="#DotDetection">Dot detection</a></li>
<li><a href="#ShiftsCorrections">Shifts and chromatic aberrations</a></li>
</ul>
</li>
<li><a href="#Troubleshooting">Troubleshooting</a></li>
</ul>


<p><a name="GettingStarted"/></p>

<h2>Getting started</h2>

<p>The best way to get introduced to the software is to ask someone
already using it!.</p>

<p><a name="Installation"/></p>

<h2>Installation</h2>

<p><a name="Dependencies"/></p>

<h3>Dependencies</h3>

<ul>
<li>OSX or Ubuntu - will not work on Windows</li>
<li>GIT</li>
<li>MATLAB</li>
<li>The GNU scientific library, GSL</li>
<li>A Compiler for C99 that works with matlab</li>
</ul>


<p><a name="Instructions"/></p>

<h3>Instructions</h3>

<p>Your machine has be recognized by the server that hosts the code, send your <code>.ssh/id_rsa.pub</code> to <a href="">erik.wernersson@scilifelab.se</a>. If you don&rsquo;t have such file, generate one with</p>

<p><code>
ssh-keygen -t rsa
</code></p>

<p>Get the code:
<code>
git clone git@erikwfractal.scilifelab.se
mv erikw.git dotter
</code>
Note: your computer has to be connected by wire in the Scilifelab
building or you have to connect using VPN.</p>

<p>Install GSL and pkg-config
<code>
sudo brew install gsl
sudo brew install pkg-config
</code></p>

<p>Make sure that MATLAB finds DOTTER when it starts, add the following lines to
your <code>~/matlab/startup.m</code>:</p>

<p><code>
setenv('DOTTER_PATH', '~/dotter/');
run([getenv('DOTTER_PATH') 'dotterStartup.m'])
addpath(getenv('DOTTER_PATH'));
</code></p>

<p>Then run this file or restart MATLAB. You should now be able to start
DOTTER with the command: <code>DOTTER</code> in MATLAB.</p>

<p>Next you need to compile some function written in C. Do so from the
menu: <em>DOTTER->Maintenanace->Compile C Functions</em>.</p>

<p>Most likely <code>mex</code> is not setup on you computer. How to do this varies
but on a mac you should install <code>XCode</code> first. Then run <code>mex -setup</code>
in MATLAB. Ask someone for help if you get stuck at this point.</p>

<p><a name="KeepingUpdated" /></p>

<h3>Keeping updated</h3>

<p>Since the files are managed by GIT you can go to a terminal, <code>cd</code> to
the directory with the source codes and do a</p>

<p><code>
git pull
</code></p>

<p>The same thing is accessible from the menubar in DOTTER,
<em>DOTTER->Maintenance->Update</em></p>

<h4>Downgrading</h4>

<p>In case that you want to use an older version, <code>git</code> is your friend.
To see all old version use (in terminal)</p>

<p><code>
git log --pretty=format:'%h %ad | %s%d [%an]' --graph --date=short
</code></p>

<p>and then to get a specific version, use</p>

<p><code>
git checkout &lt;hash&gt;
</code></p>

<p>Example:</p>

<p>```
git log &ndash;pretty=format:&lsquo;%h %ad | %s%d [%an]&rsquo; &ndash;graph &ndash;date=short
* 57a3363 2017-11-24 | v 0.471 [erikw]
* 8d18c29 2017-11-22 | v 0.462 [erikw]
&hellip;
git checkout 8d18c29</p>

<p>```</p>

<p><a name="Workflow"/></p>

<h2>Workflow</h2>

<p>The general workflow is this:</p>

<ul>
<li>Acquire images</li>
<li>Convert native image formats such that <code>nd2</code> to <code>tif</code> using DOTTER.</li>
<li>Correct for chromatic aberrations using calibration images of beads</li>
<li>Detect/segment nuclei and dots</li>
<li>Select dots</li>
<li>Analyze the results, plot and export</li>
</ul>


<p><a name="SpecificTopics"/></p>

<h2>Specific Topics</h2>

<p><a name="DotDetection"/></p>

<h3>Dot Detection</h3>

<p>Dot detection is done with <code>dotCandidates.m</code>, two key lines are</p>

<p><code>
    s.sigmadog = [1.2*s.lambda/617*voxelSize(1)/130*[1,1], ...
        1.7*s.lambda/617*voxelSize(3)/300];
</code></p>

<p><a name="ShiftsCorrections"/></p>

<h3>Shifts and chromatic aberrations</h3>

<p>Files: <code>df_cc_*.m</code>.</p>

<p>This section describes geometric aberrations to microscopy images and what we
can do about them. In short there are two major sources,</p>

<ol>
<li>Shifts between channels, caused mainly by incorrectly aligned
mirrors in the optical path (they might not be mechanically
stable and wiggle around).</li>
<li>Chromatic aberrations, including a wavelength dependent
magnifications and some other non-linearities.</li>
</ol>


<h4>Detecting them</h4>

<p>These disturbances are easiest to see when imaging beads, small
particles which emit light at all wavelengths that we are interested
in. In the ideal case, a field of view with beads captured at any
wavelength should look the same &ndash; but they look different.</p>

<p>Given an image with beads, we detect and localize dots from each
channel, to get $x_1<sup>A</sup>, x_2<sup>A</sup>, &hellip;$ for channel A and $x_1<sup>B</sup>, X_2<sup>B</sup>,
&hellip;$ for channel B, etc.</p>

<p>First we have to identify which dots corresponds to the same bead.</p>

<ul>
<li><em>Algorithm 1</em> &ndash; translation detection</li>
<li>For each $x_i<sup>A</sup>$, find the closest point in channel B,
$m_B(x_i<sup>A</sup>)$.</li>
<li>Look at the distribution of $\delta_i = (x_i<sup>A</sup>-m_B(x_i<sup>A</sup>))$. Assumption: in
most cases the closest point to $x_i$ in channel B corresponds to
the same bead. $\hat{\delta} = \hat{r}
(cos \hat{\theta},\sin \hat{\theta})$.
$\hat{r}=median(\delta_i)$, $\hat{\theta} = atan2(\sum\delta_i)$.</li>
<li>$\hat{x}<em>i<sup>A</sup> = x_i<sup>A</sup> + \delta_i$, $\hat{A} = \{ \hat{a}</em>i<sup>A</sup>
\}$</li>
<li>Match $\hat{A}$ vs $\hat{B}$ as in step 1 and 2 above, assume that
two dots corresponds to the same bead whenever $\delta_i|&lt;T$,
where $T$ is a threshold set so to tolerate the small non-linear
deformations caused by chromatic aberrations.</li>
<li><p>In the end, a set of matched points is returned, $\{ (x_i<sup>A</sup>,
x_j<sup>B</sup>) : |(x<sup>A</sup>_i+delta-x<sup>B</sup>_j)|&lt;T \}$</p></li>
<li><p><em>Algorithm 2</em> &ndash; find polynomial transformation between channels.</p></li>
</ul>


<p> This is quite straight forward, see
<a href="http://dx.doi.org/10.1046/j.1365-2818.2000.00754.x">kozubek,2000</a>.
Some notes A) Order 2 is used by default since order 3 does not show
an significant advantage. B) In z, a constant offset is used rather
than a polynomial model.</p>

<h4>In practice</h4>

<p>Whenever an important experiment is about to be image,
 1. Prepare and image beads for all relevant channels.
 2. Create a correction file (.cc) in DOTTER.</p>

<ol>
<li>Apply the correction, either on A) images directly or B) when dot
selection/detection is done. (A) is the obvious choice when the
shifts are large, otherwhise it will be hard to determine which dots
that belong to which nuclei. Alternative B) can always be used (just
make sure that A was not applied before).</li>
</ol>


<p><a name="Troubleshooting"/></p>

<h2>Troubleshooting</h2>

<p>In general, please report all errors and itches to
<a href="&#109;&#97;&#105;&#108;&#116;&#111;&#58;&#101;&#114;&#105;&#107;&#46;&#119;&#101;&#114;&#110;&#101;&#114;&#115;&#115;&#111;&#110;&#64;&#115;&#99;&#105;&#108;&#105;&#102;&#101;&#108;&#97;&#98;&#46;&#115;&#101;">&#101;&#114;&#105;&#107;&#46;&#119;&#101;&#114;&#110;&#101;&#114;&#115;&#115;&#111;&#110;&#64;&#115;&#99;&#105;&#108;&#105;&#102;&#101;&#108;&#97;&#98;&#46;&#115;&#101;</a> in order for him to
improve DOTTER.</p>

<ul>
<li><p><em>I set a value somewhere and now I can&rsquo;t change it!</em></p>

<p>DOTTER does save data that is not specific to any experiment in the
folder <code>~/.DOTTER/</code>. Remove the whole folder to reset the
configuration. This includes default directories, window placements
and emission wavelengths for fluorophores.</p></li>
</ul>

